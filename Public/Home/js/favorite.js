/* SVN.committedRevision=1559019 */
var favoriteIndexUrl=URLPrefix.central;var favoriteMy=URLPrefix.my;if(typeof currSiteType!="undefined"&&currSiteType==2){favoriteIndexUrl=URLPrefix.mall;favoriteMy=URLPrefix.mymall}var favo={popUpFavo:function(){var a;$(".mod_favorite .btn_cancel a").bind({click:function(){a=$(this).attr("favoriteId");$(".pop_cencle_favo").hide();$(".mod_favorite .pro_img").css({zIndex:"0"});$(this).parent().siblings(".pop_cencle_favo").show();$(this).parents(".pro_img").css({zIndex:"100"})}});$(".shop_overview .discard").bind({click:function(){a=$(this).attr("favoriteId");$(".pop_cencle_favo").hide();$(".shop_overview").css({zIndex:"0"});$(this).parent().siblings(".pop_cencle_favo").show();$(this).parents(".shop_overview").css({zIndex:"100"})}});$(".pop_cencle_favo .btn_no").bind({click:function(){$(this).parents(".pop_cencle_favo").hide();
if($(this).parents(".pro_img")){$(this).parents(".pro_img").css({zIndex:"1"})}if($(this).parents(".shop_overview")){$(this).parents(".shop_overview").css({zIndex:"1"})}}});$(".pop_cencle_favo .btn_ok").bind({click:function(){var f=$("#favoriteCancel_"+a).attr("favoriteType");var e=$("#favoriteCancel_"+a).attr("productId");var c=$("#currPage").val();var d=$("#operType").val();var b=$("#searchName").val();var h=$("#searchFavoriteCategory .current").attr("categoryId");var g="/member/myNewCollection/deleteNewFavorite.do?favoriteIds="+a+"&operType="+f+"&productIds="+e+"&callback=?";jQuery.getJSON(g,function(i){if(i.code==-1){yhdLogin();return false}else{if(i.code==1){loadMyFavoriteProduct(h,d,c,b)}else{$("#favoriteCancel_"+a).css("display","none");alert("取消收藏失败");return false}}})}})},search:function(a){var b=$(".mod_favorite .search_box .search_word");
if($.trim(b.val())==""||$.trim(b.val())==a){b.val(a);b.css({color:"#CCCCCC"})}else{b.css({color:"#333333"})}b.bind({focus:function(){var c=$(this);if(c.val()==a){c.val("");c.css({color:"#333333"})}},blur:function(){var d=$(this);var c=$.trim(d.val());if(c==""||c==a){d.val(a);d.css({color:"#CCCCCC"})}else{d.css({color:"#333"})}}})}};$("#searchName").keypress(function(b){var c=b.which;if(c==13){var a=$("#searchFavoriteCategory .current").attr("categoryId");loadMyFavoriteProduct(a,jQuery("#operType").val(),1,jQuery("#searchName").val())}});function executiveLandedCheck(){var b=jQuery.cookie("ut");var a=0;if(b){a=1}if(a==0){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,"",function(c){if(c==0){yhdPublicLogin.showTopLoginInfo()}});return}}function submitFavoriteNew(b,c){executiveLandedCheck();
var a="/member/myNewCollection/addNewFavorite.do?productId="+b+"&merchantId="+c+"&callback=?";jQuery.getJSON(a,function(e){$("head").append(e.pageCss);yhdLib.popwin({popcontent:e.pageHtml});var d=jQuery("#rucult_cont .more_favor");if(d.length>0){recordTrackInfoWithType("1","pms_174")}else{recordTrackInfoWithType("1","pms_174_nodata")}$(".btn_close").unbind("click").bind("click",function(){yhdLib.popclose()})})}$(function(){favo.search("查找收藏商品或店铺名称");favo.popUpFavo();_loadMyYihaodianLeftMenu.loadLeftDiv();var a=$(".tab_nav .current").attr("favoriteType");if(a==1){rollSearchProduct();compulateShopResult()}ajaxGetPromotionInfo()});function loadNewFavoriteProductByPage(b){var d=$("#searchFavoriteCategory .current").attr("categoryId");var a=$("#searchName").val();var c=$("#operType").val();if(a=="查找收藏商品或店铺名称"){loadMyFavoriteProduct(d,c,b)
}else{loadMyFavoriteProduct(d,c,b,a)}}function deleteFavorite(g){executiveLandedCheck();$("#favoriteCancel_"+g).css("display","block");var e=$("#favoriteCancel_"+g).attr("favoriteType");var d=$("#favoriteCancel_"+g).attr("productId");var b=$("#currPage").val();var c=$("#operType").val();var a=$("#searchName").val();var f=$("#searchFavoriteCategory .current").attr("categoryId");$("#favoriteCancel_"+g).find(".btn_ok").unbind("click").bind("click",function(){var h="/member/myNewCollection/deleteNewFavorite.do?favoriteIds="+g+"&operType="+e+"&productIds="+d+"&callback=?";jQuery.getJSON(h,function(i){if(i.code==1){loadMyFavoriteProduct(f,c,b,a)}else{$("#favoriteCancel_"+g).css("display","none");alert("取消收藏失败");return false}})});$("#favoriteCancel_"+g).find(".btn_no").unbind("click").bind("click",function(){$("#favoriteCancel_"+g).css("display","none")
})}function findFavoriteProductByCategoryId(b){var a=$("#category_"+b).attr("categoryId");if(a===b){return false}else{loadMyFavoriteProduct(b,0,1)}}function loadMyFavoriteProduct(e,c,b,a){if(typeof(a)=="undefined"||a=="查找收藏商品或店铺名称"){var d="/member/myNewCollection/ajaxMainPageForFavorite.do";if(e==0){d=d+"?operType="+c+"&currPage="+b}else{d=d+"?topCategoryId="+e+"&operType="+c+"&currPage="+b}jQuery.ajax({type:"post",url:d,success:function(g){if(g.indexOf("notLogin")>=0){yhdLogin();return false}$("#favoriteProductInfo").html("");$("#favoriteProductInfo").html("<div><p class='mt10'>正在处理中，请稍后...</p></div>");$("#favoriteProductInfo").html(g);jQuery(".favChoose .checkall").click(function(){if(jQuery(this).prop("checked")==true){jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",true)
})}else{jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",false)})}});jQuery(".cancelCheck").click(function(){if(jQuery(this).prop("checked")==false){jQuery(".favChoose .checkall").prop("checked",false)}else{var h=1;jQuery(".cancelCheck").each(function(){if(jQuery(this).prop("checked")==false){h=0}});if(h==1){jQuery(".favChoose .checkall").prop("checked",true)}}});if(g.indexOf("searchFavoriteCategory")>0){$("#searchFavoriteCategory li a").removeClass("current");$("#category_"+e+" a").addClass("current")}if(c==1){$("#productFavoriteCur").removeClass("current");$("#shopFavoriteCur").addClass("current")}else{$("#shopFavoriteCur").removeClass("current");$("#productFavoriteCur").addClass("current")}ajaxGetPromotionInfo();favo.popUpFavo();if(c==1){rollSearchProduct();compulateShopResult()
}}})}else{searchKeyUrl="/member/myNewCollection/ajaxMainPageForFavorite.do";var f="keyWord="+encodeURI(a)+"&topCategoryId="+e+"&operType="+c+"&currPage="+b;f=encodeURI(f);jQuery.ajax({type:"post",url:searchKeyUrl,data:f,success:function(g){if(g.indexOf("notLogin")>=0){yhdLogin();return false}$("#favoriteProductInfo").html("");$("#favoriteProductInfo").html("<div><p class='mt10'>正在处理中，请稍后...</p></div>");document.getElementById("favoriteProductInfo").innerHTML=g;jQuery(".favChoose .checkall").click(function(){if(jQuery(this).prop("checked")==true){jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",true)})}else{jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",false)})}});jQuery(".cancelCheck").click(function(){if(jQuery(this).prop("checked")==false){jQuery(".favChoose .checkall").prop("checked",false)
}else{var h=1;jQuery(".cancelCheck").each(function(){if(jQuery(this).prop("checked")==false){h=0}});if(h==1){jQuery(".favChoose .checkall").prop("checked",true)}}});if(c==1){$("#productFavoriteCur").removeClass("current");$("#shopFavoriteCur").addClass("current")}else{$("#shopFavoriteCur").removeClass("current");$("#productFavoriteCur").addClass("current")}ajaxGetPromotionInfo();favo.popUpFavo();if(c==1){rollSearchProduct();compulateShopResult()}}})}}function ajaxGetPromotionInfo(){var e=URLPrefix.search_keyword+"/p/";var d=currSiteType==2?"YIMALL":"YHD";var c="?caller=myyhd&pointSearch=0&mcsiteId="+currSiteId+"&siteType="+currSiteType+"&provinceId="+currProvinceId;var a="";$(".myFavoriteProdct").each(function(){if($(this).attr("pmInfoId")!=null&&$(this).attr("pmInfoId")!=""){a=a+"&pmInfoIds="+$(this).attr("pmInfoId")
}});if(a&&a!=""){c=c+a;var b=currSiteType==1?URLPrefix.promotion_boughtItem+c+"&callback=?":URLPrefix.promotion_1mall+c+"&callback=?";jQuery.getJSON(b,function(g){for(var f=0;f<g.length;f++){if(g[f].promotionInfo!=null){if(g[f].promotionInfo.length>0){$("#promotion_"+g[f].productId).html("<a href='"+e+"pt"+g[f].promotionInfo[0].promotionId+"-pl"+g[f].promotionInfo[0].levelId+"' target='_blank' onclick=addTrackPositionToCookie('1','"+d+"_COLLECTION_TO_DETAIL_"+g[f].productId+"')>"+g[f].promotionInfo[0].promDesc+"</a>")}}}})}}function buyFavoriteProductTocart(h){gotracker("2","","",loli.spm.getData($(".btn_add_care"),"button"));var d=jQuery("#new_fav_buy_"+h).attr("tName");var c=jQuery("#new_fav_buy_"+h).attr("pid");var g=jQuery("#new_fav_buy_"+h).attr("pmid");var b=jQuery("#new_fav_buy_"+h).attr("pcount");
var f=jQuery("#new_fav_buy_"+h).attr("yhdPrice");var a=jQuery("#new_fav_buy_"+h).attr("priceChange");var e={};e.amount=b;e.isFloat=true;e.linkPosition=d;e.merchantId=g;e.showPrice=f;e.needTip=a;addToCartNew(null,c,e)}function rollSearchProduct(){$(".featured_products").each(function(){var f=$(this).find(".roll_content li");var d=f.length;var h=f.outerWidth(true);var j=$(this);if(d<=4){return}var e=$(this).find(".roll_content");e.css("width",d*h);var i=$(this).find(".play_prew");var b=$(this).find(".play_next");b.addClass("play_next_ac");var g=$(this).find(".roll_content");var a=true;var c=function(l){var m=g.position().left;var n=~~-(m/h);var k;if(n+l*4<0){k=0-n;i.removeClass("play_prew_ac");b.addClass("play_next_ac")}else{if(n+l*4>=d-4){k=d-n-4;i.addClass("play_prew_ac");b.removeClass("play_next_ac")
}else{i.addClass("play_prew_ac");b.addClass("play_next_ac");k=l*4}}if(!!a){a=false;g.animate({left:"-="+k*h+"px"},function(){a=true})}};i.bind("click",function(){c(-1)});b.bind("click",function(){c(1)})})}function compulateShopResult(){var b=$('<div class="rank_detail"></div>');$(".shop_overview .rank").bind("mouseenter",function(){var g=($(this).attr("descriptExactExpPoint")*1).toFixed(1);var t=$(this).attr("descriptStatus");var r=$(this).attr("descriptDiffer");var k;if(t==0){k=""}else{if(t==1){k="high"}else{if(t==2){k="mid"}else{if(t==3){k="low"}else{k=""}}}}var i=(r*100).toFixed(0)+"%";var l=($(this).attr("attitudeExactExpPoint")*1).toFixed(1);var h=$(this).attr("attitudeStatus");var s=$(this).attr("attitudeDiffer");var m;if(h==0){m=""}else{if(h==1){m="high"}else{if(h==2){m="mid"}else{if(h==3){m="low"
}else{m=""}}}}var c=(s*100).toFixed(0)+"%";var d=($(this).attr("logisticsExactExpPoint")*1).toFixed(1);var n=$(this).attr("logisticsStatus");var q=$(this).attr("logisticsDiffer");var e;if(n==0){e=""}else{if(n==1){e="high"}else{if(n==2){e="mid"}else{if(n==3){e="low"}else{e=""}}}}var p=(q*100).toFixed(0)+"%";var f=$(this).offset().left-$(this).parents(".shop_overview").offset().left;var o=$(this).offset().top-$(this).parents(".shop_overview").offset().top+$(this).height();var j=$(this).width();b.css({top:o,left:f+j/2-92});a({desc:{title:"描述相符",score:g,growType:k,percent:i},atti:{title:"服务态度",score:l,growType:m,percent:c},speed:{title:"发货速度",score:d,growType:e,percent:p}});b.show();$(this).parents(".shop_overview").append(b)}).bind("mouseleave",function(c){b.hide()});b.bind("mouseenter",function(){$(this).show()
}).bind("mouseleave",function(){$(this).hide()});function a(d){var c='<div class="bg"><ul><li><span>店铺动态评分</span><em>与同行业相比</em></li>';for(var e in d){c+="<li><span>"+d[e].title+":<b>"+d[e].score+"</b></span><em class="+d[e].growType+'><i class="icon">&nbsp;</i>'+(d[e].percent?'<i class="precent">'+d[e].percent+"</i>":'<i class="non_percent">------</i>')+"</em></li>"}c+='</ul><div class="arrow">&nbsp;</div>';"</div>";b.html(c)}}function batchCancelCollect(){var c="";var g="";jQuery(".cancelCheck").each(function(){if(jQuery(this).prop("checked")==true){var h=jQuery(this).val();g=g+h+",";c=c+$("#favoriteCancel_"+h).attr("productId")+","}});if(c==""||g==""){YHD.alert("请选中商品!")}else{if(!confirm("确定要取消该商品收藏？")){return}var b=$("#currPage").val();var d=$("#operType").val();var a=$("#searchName").val();
var f=$("#searchFavoriteCategory .current").attr("categoryId");var e="/member/myNewCollection/deleteNewFavorite.do?favoriteIds="+g+"&operType="+d+"&productIds="+c+"&callback=?";jQuery.getJSON(e,function(h){if(h.code==-1){yhdLogin();return false}else{if(h.code==1){loadMyFavoriteProduct(f,d,b,a)}else{YHD.alert("取消收藏失败");return}}})}}jQuery(".favChoose .checkall").click(function(){if(jQuery(this).prop("checked")==true){jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",true)})}else{jQuery(".cancelCheck").each(function(){jQuery(this).prop("checked",false)})}});jQuery(".cancelCheck").click(function(){if(jQuery(this).prop("checked")==false){jQuery(".favChoose .checkall").prop("checked",false)}else{var a=1;jQuery(".cancelCheck").each(function(){if(jQuery(this).prop("checked")==false){a=0
}});if(a==1){jQuery(".favChoose .checkall").prop("checked",true)}}});function yhdLogin(){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,false,function(){location.reload()})};