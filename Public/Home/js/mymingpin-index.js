define(["discountinfo","countdowntime","brandforenotice","lazyLoadImage"],function(c,e,b,a){var d={totalCount:1,totalPage:1,currentPage:1,isBusy:false,flushLastActivity:false,initAll:function(){this.refreshCurrentTime();this.initScroll();this.initMouse();this.initRightNav();this.initCountTime();this.displayLastActsInfo();this.initLastDayDiscount();this.lazyLoadImage()},lazyLoadImage:function(){var f=["zxmpact","index_last_activity","foolr-3","mod_today"];a.loadImages(f)},setLazyLoad:function(){var j=$("#mod_today").find("img[original]");for(var g=0;g<j.length;g++){var f=jQuery(j[g]);var h=loli.webp(f.attr("original"));f.attr("src",h).removeAttr("original")}},refreshCurrentTime:function(){$.ajax({type:"POST",url:"/mingpinAjax/ajaxGetCurrentTime.do",dataType:"json",async:false,success:function(f){d.showNewYugao(f);
b.showYugao(f);$("#lastServerTime").val(f);d.initNewActivityList(f,d.currentPage)},error:function(){var h=$("#lastServerTime").val();if(!h){var g=new Date();var f=g.getTime();h=f+","+f+",0"}}})},initScroll:function(){$(window).bind("scroll",d.runLazyLoadAct)},initMouse:function(){var f="mousedown mousewheel keydown DOMMouseScroll";$(window).bind(f,function(){$(window).one("scroll",d.runLazyLoadAct)})},initRightNav:function(){$("#right_nav li").click(function(){$(window).unbind("scroll",d.runLazyLoadAct)})},initCountTime:function(){window.setTimeout(function(){d.CountdownTime()},1000)},initLastDayDiscount:function(){var g=$("#index_last_activity .berserk-item");var f=[];if(g.length>0){$.each(g,function(h,j){var k=$(j).attr("id");var l=k.split("_")[1];f.push(l)})}if(f.length>0){d.getActivityDiscountByActivityIds(f,d.refreshLastDayActivityDiscount)
}},displayLastActsInfo:function(){if(!d.flushLastActivity){$.ajax({type:"get",url:"/mpSquidAjax/ajaxGetLastMingpinActivityList.do",dataType:"html",async:false,success:function(f){d.flushLastActivity=true;$("#index_last_activity").html(f)}})}},CountdownTime:function(){e.CountdownTime();window.setTimeout(function(){d.CountdownTime()},1000)},runLazyLoadAct:function(){var h=$("#lastServerTime").val();var i=$(document).scrollTop();var g;if(window.lazyLoadId){g=$("#"+window.lazyLoadId).offset().top}else{g=$("#zxmp").offset().top}var f=$("#foolr-2").offset().top;if(((i+$(window).height()+1500)>=g)&&((i+400)<f)){d.initNewActivityList(h,d.currentPage)}},initNewActivityList:function(g,f){if(d.isBusy){return}d.isBusy=true;if(!d.totalCount){return}if(!f){f=1}if(f>d.totalPage){return}$.ajax({type:"get",async:false,url:"/mpSquidAjax/ajaxGetNewMingpinActivityList.do",data:{currentPage:f},dataType:"html",success:function(h){d.getActivityList4Page(g,h)
}})},getActivityList4Page:function(j,k){var i=$(k);if(!i||i.length<1){return}var g=j.split(",");d.totalCount=parseInt($(i[0]).attr("data-total-count"));d.totalPage=parseInt($(i[0]).attr("data-total-page"));d.currentPage=d.currentPage+1;var h=$.grep(i,d.validAct(g[0]));var l=d.convertArray(h,"id");var f=[];if(l.length==i.length){d.isBusy=false;d.initNewActivityList(j,d.currentPage)}else{$.each(i,function(m,o){var p=$(o).attr("id");if(p&&p!=""){var n=$.inArray(p,l);if(n<0){f.push(p.split("_")[1]);$("#zxmp").before(o);if(m==i.length-1){window.lazyLoadId=p}}}});d.isBusy=false;c.getActivityDiscountByActivityIds(f)}},validAct:function(f){return function(k,j){var h=$(k).attr("data-startTime");var g=$(k).attr("data-endTime");var l=$(k).attr("data-fixSite");if((l==0&&f<h)||f>g){return true}return false
}},convertArray:function(f,h){var g=[];$.each(f,function(j,k){g.push(k[h])});return g},getActivityDiscountByActivityIds:function(f,g){if(f.length>0){$.ajax({url:"/mingpinAjax/findMingpinActivityDiscountInfoByActivityIds.do",data:{activityIds:f},type:"POST",async:false,dataType:"json",traditional:true,success:function(h){if(!h){return}g(h)}})}},setTab:function(f,h,g){f.each(function(i){var j=$(this);j.on("mouseenter",function(){j.addClass("active").siblings().removeClass("active");j.parents().find(h).find(g).eq(i).show().siblings().hide()})})},showNewYugao:function(g){var f=g.split(",");if(f[0]>=f[1]){d.setNewYugao(0)}else{d.setNewYugao(4)}},setNewYugao:function(q){var m=$("textarea[id^='newyugao_']");var k=$("textarea[id^='yugaoHead_']");var p=m.length;var o=0;var r=1;for(var v=0;v<p;v++){if(v!=q){var w=m.get(v);
var y=$(w).text();$("#newygplan_"+o).html(y);w=k.get(v);y=$(w).text();var n=y.split(",");var f=n[0];var u=n[1];var h=u.indexOf("/")+1;u=u.substring(h);u=$.trim(u);if(q==4&&v==0){f="今天";if(!yugaoTime){yugaoTime=10}u=yugaoTime+":00";r=0}if(r==1){f="明日"}if(r==2){f="后天"}newval="<h3>"+f+"预告</h3><p>"+u+"</p>";$("#newyghead_"+o).html(newval);o++;r++}}var l=$(".tab li");d.setTab(l,".tab-body",".tab-cont");var j=$(".tab-li li");j.each(function(i){var A=$(this);var z=A.find(".tips-arrow");A.mouseenter("mouseenter",function(){A.addClass("active").siblings().removeClass("active");A.parents().find(".tab-body").children(".tab-li-cont").eq(i).show().siblings().hide()})});var g=$(".tab-lab-active li");d.setTab(g,".tab-cont-lab",".tab-cont-body");var x=$(".tab-ul");x.each(function(){var D=$(this);var z=D.find(".tab-li li");
var A=D.find(".tab-li-cont");var B=D.find(".agree");var i=D.find(".agree-info");var C=D.find(".agree-bg");D.mouseenter(function(){D.stop().animate({height:"279"},450)}).mouseleave(function(){z.removeClass("active");D.stop().animate({height:"100",overflow:"hidden"},480,function(){A.hide()});B.css("height","50px");C.css("height","50px");i.hide()})});var s=$(".tab-li-cont");agreeBtn=s.find(".agree-btn"),agreeRes=s.find(".agree-enter");agreeRes.keydown(function(){this.value=this.value.replace(/\D/g,"")});agreeBtn.click(function(){var B=$(this),G=B.parents(".tab-li-cont").find(".agree"),D=B.parents(".tab-li-cont").find(".agree-bg"),i=B.parents(".tab-li-cont").find(".agree-info"),C=B.parents(".tab-li-cont").find(".agree-enter"),F=B.parents(".tab-li-cont"),A=B.parents(".tab-li-cont").attr("brandId"),E=1,H=C.val();
var z=new RegExp(/^((13)|(15)|(18))\d{9}$/);if(C.val()==""||(!z.test(H))){G.css("height","70px");D.css("height","70px");i.show();return}else{$.post("/mingpin/addSubscribeInfo.do",{activityIds:A,contactInfo:H,subscribeModel:E},function(J){if(J=="SUCCESS"){G.remove();var I=$('<div class="trailer-ok"><i class="sprite"></i><span>已订阅</span></div>');F.append(I);$.cookie("sub_activityIds",null);$.cookie("phoneNum",H)}else{$.cookie("sub_activityIds",null);if(J==""){J="亲，请先登陆~"}alert(J)}})}});var t=$(".Js_trailer");t.each(function(E){var D=$(this),I=D.find(".agree"),C=D.find(".agree-bg"),H=D.find(".img-scale"),G=D.find(".trailer-ok"),A=D.find(".agree-input"),z=D.find(".agree-enter"),i=D.find(".agree-info"),B=D.find(".agree-btn"),F=D.find(".trailer-item-pic");z.keydown(function(){this.value=this.value.replace(/\D/g,"")
});B.click(function(){orderbrand.checkOrderBrand(D)});D.mouseenter(function(){H.addClass("hover-scale");I.css("top","103px");G.fadeIn("slow")}).mouseleave(function(){H.removeClass("hover-scale");I.css("top","153px");G.fadeOut("fast");i.hide()})})},refreshLastDayActivityDiscount:function(k){var p=k.mingpinActivityList;for(var m=0;m<p.length;m++){var t=p[m];var f=t.id;var s=t.discountInfo;var l=t.discountType;var h=t.startTime;var q=c.getDiscountNum(s);var j=c.getDiscountTypeString(l);var n="#lastDayDiscount_"+f}var g=k.mingpinActivitySaleDataVoList;for(var m=0;m<g.length;m++){var t=g[m];var f=t.activityId;var r=t.saleNum;var n="#lastDay_"+f;if($(n).length>0&&r>0){var o=(r+"人已购买");$(n+" .about").html(o)}}}};return d});