/* SVN.committedRevision=1560685 */
$(document).ready(function(){$(".grouProvince").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});if($("#grouponSearchEnable")&&$("#grouponSearchEnable").val()=="1"){$("#hd_search_tuan").show()}$("#hd_search_tuan").bind("click",function(){var c=$("#keyword").val();try{gotracker("2","YHD_GROUPON_GLOBAL_SEARCH"+c)}catch(a){}if(c==""||c=="请输入关键词"){$("#keyword").focus();return}else{var b="http://t.yhd.com/search?searchWord="+encodeURIComponent(c);location.href=b}});try{var g=$.cookie("grouponAreaId");if(g!=undefined&&g!=""){var h=$("#grouponPrvcBox").find("a[aid="+g+"]");if(h){var f=h.attr("title");if(f!=""){$("#grouponPrvcBox").find("li").attr("class","");$("#grouponProvince").html(f+"<span>[更换]</span>");h.parent().attr("class","cur")}}}}catch(e){}try{require(["content_tracker_expo"],function(a){a.run("adContentTrackerEvent","ad.dolphin.bidding")
})}catch(e){}});var tenclock={listInt:function(){this.lunbo();this.timeaxis();this.listHover();this.soon_nav();this.yhderwei()},lunbo:function(){var f=0;var e=1;var c=5000;var a=1;var b;$("#banner .d1").hide();$("#banner .d1").eq(0).fadeIn("slow");if($("#banner .d1").length>1){$("#banner_id li").eq(0).addClass("on");function d(){e=f+1;if(e>$("#banner .d1").length-1){e=0}$("#banner .d1").eq(f).css("z-index","2");$("#banner .d1").eq(e).css("z-index","1");$("#banner .d1").eq(e).show();$("#banner .d1").eq(f).fadeOut("slow");$("#banner_id li").removeClass("on");$("#banner_id li").eq(e).addClass("on");f=e}b=setInterval(d,c);$("#banner_id li").click(function(){var g=$("#banner_id li").index(this);if(g!=f&&a==1){a=0;$("#banner .d1").eq(f).css("z-index","2");$("#banner .d1").eq(g).css("z-index","1");$("#banner .d1").eq(g).show();
$("#banner .d1").eq(f).fadeOut("slow",function(){a=1});$("#banner_id li").removeClass("on");$("#banner_id li").eq(g).addClass("on");f=g}});$("#banner_id").hover(function(){clearInterval(b)},function(){b=setInterval(d,c)})}else{$("#banner_id").hide()}},timeaxis:function(){var b=$("#timeaxis"),c=b.find(".timeaxis"),k=c.find("li[flag]"),f=k.length-1,e=$(".laybox"),a=b.offset().top,h=c.outerHeight(true),d=$(this).index(),g;var j=$("mob_time_review");k.width((95/f)+"%").last().width(5+"%").addClass("tom_tra");if(b.length==0){return false}k.bind("click",function(){var i=$(this).index();clickItemIndex=i;currentItem=i;var l=e.eq(i).offset().top;$("body,html").stop().animate({scrollTop:(l-h)+5},500)});$(window).scroll(function(){g=document.documentElement.scrollTop||document.body.scrollTop;if(g>a){b.addClass("layfixed")
}else{b.removeClass("layfixed")}if(oldSTop==null){oldSTop=g}else{if((g-oldSTop)>0){isDown=true}else{isDown=false}oldSTop=g}k.each(function(){var l=$(this).index();var m=e.eq(l).offset().top;if(g>=(m-h)){currentItem=l;e.eq(l).addClass("anchor").siblings().removeClass("anchor");if(l!=f){if(clickItemIndex!=-1){if(clickItemIndex==l){TuangouHourBuy.biz.lazyLoadDom(e.eq(l).attr("hbid"));clickItemIndex=-1}}else{if(isDown){if(l<currentItem){return false}}TuangouHourBuy.biz.lazyLoadDom(e.eq(l).attr("hbid"))}}}})})},yhderwei:function(){var a=$(".yhderwei");a.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})},listHover:function(){var b=$(".grouplist");var a=b.find("li");a.each(function(){var d=$(this).find(".show_per");var c=$(this).find(".show_btn");$(this).hover(function(){var e=$(this).find(".listbox");
$(this).addClass("hover");if(!e.hasClass("expire")){c.show();d.hide()}else{return false}},function(){var e=$(this).find(".listbox");$(this).removeClass("hover");if(!e.hasClass("expire")){c.hide();d.show()}else{return false}})})},soon_nav:function(){var a=$(".soon_nav li").length;$(".soon_nav li").width((100/a)+"%");$(".soon_nav").children().hover(function(){$(this).addClass("cur").siblings().removeClass("cur");var b=$(".soon_nav").children().index(this);$(".soon_con").children().eq(b).show().siblings().hide();var c=$(".soon_con").children().eq(b).attr("hbid");TuangouHourBuy.biz.lazyLoadTMDom(c)})}};jQuery(document).ready(function(){tenclock.listInt();timeClock();addTrackerEvent();TuangouHourBuy.biz.init()});var currentHbid=null;var clickItemIndex=-1;var currentItem=-1;var oldSTop=null;var isDown=true;function timeClock(){var a=URLPrefix.central+"/time/dynamictime";jQuery.getScript(a,function(){if(nowTime!=undefined&&nowTime!=null){var b=nowTime.split("-");date=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);timeClockInner(date.getTime())}})}function timeClockInner(c){var a=$("#timeaxis").find("li[flag=today]");if(a){var d=null;var b=null;a.each(function(){d=$(this).attr("starttime");b=$(this).attr("endtime");hbid=$(this).attr("hbid");var e=$("div[flag=floor][hbid="+hbid+"]");if(c>=d&&c<b){currentHbid=hbid;$(this).attr("class","in_time cur");e.find(".hd_time_txt").html("抢购中");e.find(".hd_time_txt").attr("class","hd_time_txt time_txt_on");
$(this).click();clockItem(c,$(this))}else{if(c>=b){$(this).attr("class","over_time");e.find(".end_time").hide();e.find(".hd_time_txt").hide()}else{e.find(".hd_time_txt").html("即将开团");clockItem(c,$(this))}}})}}function clockItem(e,b){var g=b.attr("starttime");var a=b.attr("endtime");var d=0;var f=b.attr("hbid");var c=0;if(e<g){d=g-e;c=0}else{if(a>e){d=a-e;c=1}else{c=2}}if(c==2){$(this).attr("class","over_time")}else{executeCompu(c,d,g,a,f,b)}}function executeCompu(n,m,o,C,u,E){if(n==2){return}var x=$("div[flag=floor][hbid="+u+"]");if(m<=0){if(n==1){n=2;x.find(".end_time").hide();x.find(".hd_time_txt").hide();$("#timeaxis").find("li[flag=today][hbid="+u+"]").attr("class","over_time")}else{if(n==0){n=1;var e=$("#timeaxis").find("li[flag=today][hbid="+currentHbid+"]");if(e){e.attr("class","over_time")
}currentHbid=u;$("#timeaxis").find("li[flag=today][hbid="+currentHbid+"]").attr("class","in_time cur");$("#timeaxis").find("li[flag=today][hbid="+currentHbid+"]").click();m=C-o;x.find(".hd_time_txt").html("抢购中");x.find(".hd_time_txt").attr("class","hd_time_txt time_txt_on");x.find(".end_time_tit").html("距离本场结束还有")}}$("div[flag=floor]").each(function(){TuangouHourBuy.biz.ajaxRefreshGroupon($(this))})}if(m>=0){if(n==1){x.find(".hd_time_txt").html("抢购中");x.find(".end_time_tit").html("距离本场结束还有")}else{if(n==0){x.find(".hd_time_txt").html("即将开团");x.find(".end_time_tit").html("距离本场开始还有")}}var t=m;var g=86400000;if(t>g&&t<g*3){var b=Math.floor(t/1000/60/60/24);var D=Math.floor((t/1000/60/60)%24);x.find(".cd1").html(b+"天"+D+"小时").show()}if(t>=g*3){x.find(".cd1").html("3天以上").show()}if(t<g){x.find(".cd1").hide();
x.find(".count_one").show();var A=35;var z=x.find(".h1 span");var y=x.find(".h2 span");var j=x.find(".m1 span");var i=x.find(".m2 span");var l=x.find(".s1 span");var k=x.find(".s2 span");var p=t;var r=Math.floor(p/3600000);p-=r*3600000;var B=Math.floor(p/60000);p-=B*60000;var F=Math.floor(p/1000);var h=r<10?"0"+r:r;var f=B<10?"0"+B:B;var d=F<10?"0"+F:F;var w=String(h).substr(0,1);var v=String(h).substr(1,1);var c=String(f).substr(0,1);var a=String(f).substr(1,1);var s=String(d).substr(0,1);var q=String(d).substr(1,1);z.animate({top:-w*A});y.animate({top:-v*A});j.animate({top:-c*A});i.animate({top:-a*A});l.animate({top:-s*A});k.animate({top:-q*A});setTimeout(function(){m-=1000;executeCompu(n,m,o,C,u,E)},1000)}}}function addTrackerEvent(){var a=document.getElementById("tuangouBody");var b=function(h){var f=getEvent(h);
var g=getTarget(f);var c=$(g);var d=c.attr("tracker");if(d==undefined||d==null){d=c.parent().attr("tracker")}if(d){addTrackPositionToCookie("1",d)}};addEvent(a,"click",b)}function addEvent(c,b,a){if(!c){return false}if(c.addEventListener){c.addEventListener(b,a,false);return true}else{if(c.attachEvent){c.attachEvent("on"+b,function(){a.apply(c)});return true}}return false}function getEvent(a){return a||window.event}function getTarget(a){return a.target||a.srcElement}function stopPropagation(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}};var TuangouHourBuy={};TuangouHourBuy.biz={};TuangouHourBuy.biz.init=function(){TuangouHourBuy.biz.lazyLoad();TuangouHourBuy.biz.lazyLoadHisDom(jQuery(".lazyload"));TuangouHourBuy.biz.bsRefresh()};TuangouHourBuy.biz.bindHisList=function(a){if(a&&a.length>0){TuangouHourBuy.biz.ajaxRefreshLoadGroupon($("div[flag=his]"),a)}};TuangouHourBuy.biz.lazyLoad=function(){lazyLoadImageObjArry=lazyLoadImageObjArry||[];lazyLoadImageObjArry.push("tuangouBody");initImageLoad();jQuery.YHD.imgLoad.load()};TuangouHourBuy.biz.bsRefresh=function(){$("div[flag=floor]").each(function(){TuangouHourBuy.biz.ajaxRefreshGroupon($(this))});$("div[flag=tm]").each(function(){TuangouHourBuy.biz.ajaxRefreshGroupon($(this))});$("div[flag=his]").each(function(){TuangouHourBuy.biz.ajaxRefreshGroupon($(this))})};function caculateRateOfSold(a,c){var b=100*(a/c);
s_x=b.toString();pos_decimal=s_x.indexOf(".");if(pos_decimal>0){b=s_x.substr(0,pos_decimal+3)}return b}TuangouHourBuy.biz.lazyLoadDom=function(d){var c=$("div[flag=floor][hbid="+d+"]").find("#textarealazyload");if(!c){return}var a=$("div[flag=floor][hbid="+d+"]").attr("loaded");if(a==1||a==0.5){return}$("div[flag=floor][hbid="+d+"]").attr("loaded",0.5);var b=$(c.val()).filter(function(e){return this.nodeName=="LI"});b.insertBefore(c);$("div[flag=floor][hbid="+d+"]").attr("loaded",1);TuangouHourBuy.biz.ajaxRefreshLoadGroupon($("div[flag=floor][hbid="+d+"]"),b);tenclock.listHover()};TuangouHourBuy.biz.lazyLoadTMDom=function(d){var c=$("div[flag=tm][hbid="+d+"]").find("#textarealazyload");if(!c){return}var a=$("div[flag=tm][hbid="+d+"]").attr("loaded");if(a==1||a==0.5){return}$("div[flag=tm][hbid="+d+"]").attr("loaded",0.5);
var b=$(c.val()).filter(function(e){return this.nodeName=="LI"});b.insertBefore(c);$("div[flag=tm][hbid="+d+"]").attr("loaded",1);TuangouHourBuy.biz.ajaxRefreshLoadGroupon($("div[flag=tm][hbid="+d+"]"),b);tenclock.listHover()};function getUrlOfQiangguang(a,d,e,b,c){if(d!=undefined&&d!=""){return"http://t.yhd.com/detailBrand/"+d}if(a!=undefined&&a==2){return"http://shop.yhd.com/m-"+e+".html"}if(b!=undefined&&b!=""){return"http://t.yhd.com/100-0-"+b+"-1-1.html"}return"http://t.yhd.com/detail/"+c}TuangouHourBuy.biz.ajaxRefreshGroupon=function(c){if(!c){return}var d="";jqitems=c.find("li[gid]");jqitems.each(function(){var f=$(this).attr("gid");if(f){d+="grouponIds="+f+"&"}});var e=jQuery.cookie("provinceId");if(d.length>0){var b=URLPrefix.busystock;if(grouponBsEnabled&&grouponBsEnabled==1){b=URLPrefix.tuancentral
}var a=b+"/restful/groupon?provinceId="+e+"&"+d+"callback=?";jQuery.getJSON(a,function(f){$(f).each(function(){var m=this.grouponId;var o=c.find("li[gid="+m+"]");if(!o){return}if(this.code!=null&&this.code!=undefined&&this.code=="0"){return}var k=this.type;var h;var i=this.siteType;var g="";var l=0;if(currSiteId==1){if((i==1&&marketYhdPriceEnable==1)||(i==2&&marketPriceEnable==1)){h=this.marketPrice}else{h=this.yhdPrice}}else{if(currSiteId==2){h=this.marketPrice}}var n=this.soldNum;if(k!="1"){if(i==2){if(n>this.peopleUpper){n=this.peopleUpper}}}if(this.currentPrice!=null&&this.currentPrice!=undefined){o.find("#currentPrice").html(this.currentPrice)}if(h!=null&&h!=undefined){o.find("#marketPrice").html(h)}try{if(this.wholeCountry!=undefined&&this.wholeCountry!=null){if(this.wholeCountry==1||this.wholeCountry==3){o.find("#postSpan").html('<img class="ico_tag" src="'+URLPrefix.statics+'/groupon/pic/ico.png">')
}else{o.find("#postSpan").html("")}}}catch(j){}if(k=="0"){if(this.status==102){g=getUrlOfQiangguang(i,o.attr("bid"),this.merchantId,o.attr("cid"),o.attr("gid"));o.find("a").attr("href",g);o.find("div:first").attr("class","listbox expire clearfix");o.find(".per_num").hide();o.find(".show_btn").hide()}else{l=caculateRateOfSold(n,this.peopleUpper);if(i==1){if(n>=this.peopleUpper){l=caculateRateOfSold(this.curSoldNum,this.peopleUpper)}}o.find("div:first").attr("class","listbox onsale clearfix");o.find(".per_num").html('<i id="bar" style="width:'+l+'px;"></i><span>已抢购<em id="buyRate">'+l+"%</em></span>");o.find(".show_btn").html('<a target="_blank" href=http://t.yhd.com/detail/'+m+">立即抢购</a>");o.find(".per_num").show();o.find(".show_btn").hide()}}else{if(k=="-1"){g=getUrlOfQiangguang(i,o.attr("bid"),this.merchantId,o.attr("cid"),o.attr("gid"));
o.find("a").attr("href",g);o.find("div:first").attr("class","listbox expire clearfix");o.find(".per_num").hide();o.find(".show_btn").hide()}else{if(k=="1"){o.find("div:first").attr("class","listbox readysale clearfix");o.find(".per_num").html("<span>限量<em>"+this.peopleUpper+"</em>件</span>");o.find(".show_btn").html('<span class="ready_tips">即将开团</span><em>'+this.reserveNum+"</em>人订阅")}}}if(this.stockAvailable=="0"&&k!="1"){g=getUrlOfQiangguang(i,o.attr("bid"),this.merchantId,o.attr("cid"),o.attr("gid"));o.find("a").attr("href",g);o.find("div:first").attr("class","listbox expire clearfix");o.find(".per_num").hide();o.find(".show_btn").hide()}})})}};TuangouHourBuy.biz.ajaxRefreshLoadGroupon=function(d,b){var e="";b.each(function(){var g=$(this).attr("gid");if(g){e+="grouponIds="+g+"&"}});var f=jQuery.cookie("provinceId");
if(e.length>0){var c=URLPrefix.busystock;if(grouponBsEnabled&&grouponBsEnabled==1){c=URLPrefix.tuancentral}var a=c+"/restful/groupon?provinceId="+f+"&"+e+"callback=?";jQuery.getJSON(a,function(g){$(g).each(function(){var o=this.grouponId;var n=d.find("li[gid="+o+"]");if(!n){return}if(this.code!=null&&this.code!=undefined&&this.code=="0"){return}var m=this.type;var i;var h=this.siteType;var j="";var k=0;if(currSiteId==1){if((h==1&&marketYhdPriceEnable==1)||(h==2&&marketPriceEnable==1)){i=this.marketPrice}else{i=this.yhdPrice}}else{if(currSiteId==2){i=this.marketPrice}}var l=this.soldNum;if(m!="1"){if(h==2){if(l>this.peopleUpper){l=this.peopleUpper}}}if(this.currentPrice!=null&&this.currentPrice!=undefined){n.find("#currentPrice").html(this.currentPrice)}if(i!=null&&i!=undefined){n.find("#marketPrice").html(i)
}if(m=="0"){if(this.status==102){j=getUrlOfQiangguang(h,n.attr("bid"),this.merchantId,n.attr("cid"),n.attr("gid"));n.find("a").attr("href",j);n.find("div:first").attr("class","listbox expire clearfix");n.find(".per_num").hide();n.find(".show_btn").hide()}else{k=caculateRateOfSold(l,this.peopleUpper);if(h==1){if(l>=this.peopleUpper){k=caculateRateOfSold(this.curSoldNum,this.peopleUpper)}}n.find("div:first").attr("class","listbox onsale clearfix");n.find(".per_num").html('<i id="bar" style="width:'+k+'px;"></i><span>已抢购<em id="buyRate">'+k+"%</em></span>");n.find(".show_btn").html('<a target="_blank" href=http://t.yhd.com/detail/'+o+">立即抢购</a>");n.find(".per_num").show();n.find(".show_btn").hide()}}else{if(m=="-1"){j=getUrlOfQiangguang(h,n.attr("bid"),this.merchantId,n.attr("cid"),n.attr("gid"));
n.find("a").attr("href",j);n.find("div:first").attr("class","listbox expire clearfix");n.find(".per_num").hide();n.find(".show_btn").hide()}else{if(m=="1"){n.find("div:first").attr("class","listbox readysale clearfix");n.find(".per_num").html("<span>限量<em>"+this.peopleUpper+"</em>件</span>");n.find(".show_btn").html('<span class="ready_tips">即将开团</span><em>'+this.reserveNum+"</em>人订阅")}}}if(this.stockAvailable=="0"&&m!="1"){j=getUrlOfQiangguang(h,n.attr("bid"),this.merchantId,n.attr("cid"),n.attr("gid"));n.find("a").attr("href",j);n.find("div:first").attr("class","listbox expire clearfix");n.find(".per_num").hide();n.find(".show_btn").hide()}})})}};var grouponMicroPageNo=4;var microPageNoPerPage=20;TuangouHourBuy.biz.lazyLoadHisDom=function(ele){if(!ele.length){return}var lazyLoads=[];var lazyLoad=ele.eq(0);
var page=lazyLoad.attr("page")||1;var callback=lazyLoad.attr("callback");lazyLoad.removeAttr("page").removeAttr("callback");var info={page:page};if(callback){try{info.callback=eval(callback)}catch(e){alert(e)}}lazyLoad.data("info",info);lazyLoads.push(lazyLoad);function runLazyLoad(){var top=document.documentElement.clientHeight+Math.max(document.documentElement.scrollTop,document.body.scrollTop);var theHeight=1000;var lazyLoad=lazyLoads.shift();if(lazyLoad){if(lazyLoad.offset().top<=top+theHeight){requestItem(lazyLoad)}else{lazyLoads.push(lazyLoad)}}}var textAreaLazyLoad;function requestItem(lazyLoad){var info=lazyLoad.data("info");if(info.page>microPageNoPerPage){return}if(textAreaLazyLoad==undefined){textAreaLazyLoad=$($("#histextarealazyload").val()).filter(function(index){return this.nodeName=="LI"
})}var item=textAreaLazyLoad.filter(function(index){return index>=grouponMicroPageNo*(info.page-2)&&index<grouponMicroPageNo*(info.page-1)});item.insertBefore(lazyLoad);tenclock.listHover();try{if(info.callback){info.callback.call(item,item)}}catch(e){}info.page=parseInt(info.page)+1;lazyLoads.push(lazyLoad)}runLazyLoad();jQuery(window).bind("scroll",function(){runLazyLoad()})};function searchGroupon(){var b=$("#searchWord").val();if(b==""){alert("请输入搜索关键字");$("#searchWord").focus();return}addTrackPositionToCookie("1","YHD_GROUPON_INDEX_SEARCH");loli.spm.openPage($("#search_submit"),"/search?searchWord="+b)}function searchMe1(){$("#keyword").unbind("keydown").bind("keydown",function(c){if(c.keyCode==13){var d=$("#keyword").val();if(d==""){alert("请输入搜索关键字");$("#keyword").focus();return}addTrackPositionToCookie("1","YHD_GROUPON_INDEXTOP_SEARCH");loli.spm.openPage($("#hd_search_tuan"),"/search?searchWord="+d)}})}$(document).ready(function(){searchMe1();$("#searchWord").focusin(function(){$(this).val("")});$("#searchWord").focusout(function(){if($.trim($(this).val())==""){$(this).val($(this).attr("original"))}});$("#searchWord").keydown(function(d){var c=d.which;if(c==13){$(this).attr("original",$(this).val());
searchGroupon()}});$(".searbox .tag_list a").click(function(b){$("#searchWord").val($(this).html());searchGroupon()})});